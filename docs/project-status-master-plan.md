# ATLAS 프로젝트 점검 보고서 & 보완 설계 완성본 (v2)

> 목적: 이미 확장된 코드베이스를 **실제 운영 가능한 벤치마크 시스템**으로 수렴시키기 위한 실행 문서.

---

## 0) Executive Summary

현재 레포는 “기획 부족” 상태가 아니라, 반대로 기능이 빠르게 늘어난 상태입니다. 따라서 지금 최우선 과제는 기능 추가가 아니라 **운영 안정성·재현성·실험 통제력 확보**입니다.

핵심 결론은 3가지입니다.

1. **확장보다 수렴:** Crypto + Single Agent를 먼저 고정해 72h 무중단 운용을 통과한다.
2. **성과보다 관측 가능성:** 수익률 이전에 실패 원인을 5분 안에 추적 가능한 구조를 완성한다.
3. **단계적 해금:** Multi-Agent, KRX/US, 고급 통계는 단계적으로 열고 각 단계마다 Go/No-Go 기준으로 통제한다.

---

## 1) 현재 상태 점검 (Repository 기반)

## 1-1. 강점 (이미 확보된 자산)
- 문서 자산: `docs/architecture.md`, `docs/roadmap.md`, `docs/review.md`가 존재.
- 모듈 자산: `src/core`, `src/data`, `src/llm`, `src/agents`, `src/simulator`, `src/analytics`, `src/dashboard`가 모두 구성.
- 어댑터 자산: DeepSeek/Gemini/Claude/GPT + 파서 + 비용 추적 + 호출 로그 파일 구조 확보.
- 시각화 자산: 대시보드 페이지가 상태/리스크/리플레이까지 확장되어 운영 관점으로 전환 가능한 기반 확보.

## 1-2. 운영 리스크 (즉시 보완 필요)
- 기능 증가 대비 운영 표준(실험 버전, 로그 스키마, 장애 복구 런북)이 단일 문서로 고정되지 않음.
- P0/P1/P2 우선순위는 정의됐지만 “어디서 멈추고 검증할지” 컷라인이 약함.
- 실험 통제(Feature Flag, Baseline 고정, 실험 식별자) 미흡 시 결과 해석이 어려워질 가능성 높음.

---

## 2) 설계 원칙 재정의 (운영 중심)

1. **Single Source of Truth:** 모든 실험 판단은 `experiment_id` 단위 로그와 리포트 기준.
2. **Fail Isolated, Not Global:** 개별 에이전트 실패는 HOLD로 격리, 사이클 전체는 지속.
3. **Observability First:** 성능 최적화 전에 추적성(누가/언제/왜 실패했는지) 확보.
4. **Reproducibility by Default:** 스냅샷/프롬프트/원문응답/파싱결과를 동일 키 체계로 저장.
5. **MVP-first Governance:** P0 미통과 시 P1/P2 개발 금지.

---

## 3) 단계별 운영 전략 (Phase A/B/C)

## Phase A — 운영 안정화 (필수)
- 범위: `CRYPTO + Single(DeepSeek/Gemini/Claude/GPT-ref) + Buy&Hold`
- 목표: 72h 무중단 + 파이프라인 무결성(수집→시그널→체결→지표→대시보드)
- 산출물:
  - 사이클 성공률
  - 모델별 파싱 성공률
  - 장애 유형 분포(네트워크/파싱/DB/타임아웃)

### Phase A Go/No-Go 기준
- Cycle success rate ≥ 97%
- Parse success rate ≥ 95%
- 치명 장애(Major) 0건
- 리플레이 샘플 20건 중 재현 실패 0건

## Phase B — 실험 확장 (권장)
- 범위: Multi-Agent(모델 1개부터), CAA 비교, 이벤트 트리거 도입
- 목표: “멀티가 싱글 대비 비용 대비 유의미한가?” 검증

### Phase B Go/No-Go 기준
- P95 사이클 지연이 Phase A 대비 2배 이내
- 멀티 경로 실패가 싱글 경로에 전파되지 않음
- CAA/Cost per Signal 대시보드 카드 안정 노출

## Phase C — 시장 확장 (선택)
- 범위: KRX/US 활성화, 뉴스/매크로/국면 분석 강화
- 목표: 시장별 일반화 가능성 및 국면별 일관성 평가

---

## 4) 운영 아키텍처 보강안

## 4-1. 실험 식별자 규약
- `experiment_id`: 실험 세션 단위 (예: `crypto_single_v1_2026w07`)
- `cycle_id`: 실행 주기 단위
- `agent_run_id`: 모델×아키텍처 단위

모든 테이블/로그/리포트는 위 3개 키를 공통 메타데이터로 포함.

## 4-2. 장애 등급 체계
- **P0 Critical:** 전체 루프 중단, 데이터 손실 가능
- **P1 Major:** 일부 에이전트 연속 실패, 자동 복구 필요
- **P2 Minor:** 파싱 재시도 후 복구, 성과 영향 제한적

## 4-3. 런북(Runbook) 최소 항목
1. API rate limit 대응(백오프/쿨다운)
2. DB 장애 시 로컬 큐 적재/재전송
3. WebSocket 끊김 재연결 정책
4. 파서 실패 시 HOLD 대체 정책
5. 대시보드 지연 시 캐시 TTL/쿼리 범위 축소

---

## 5) 지표 체계 (KPI + Guardrail)

## 5-1. 운영 KPI
- Cycle success rate
- Mean/P95 cycle latency
- Parse success rate
- Error budget 소진율

## 5-2. 투자 성과 KPI
- CR, MDD, Sharpe, Win Rate
- Cost per Signal
- **CAA (Cost-Adjusted Alpha)** = (전략 수익률 - Buy&Hold) / 총 API비용

## 5-3. Guardrail (안전장치)
- 단일 사이클 손실 임계치
- 포지션 최대 비중
- 현금 최소 비중
- API 비용 일간 상한

---

## 6) 실행 로드맵 (현실형)

## Week 0.5 (즉시)
- 기능 인벤토리 확정(핵심 경로 기준)
- 실험 설정 동결: `crypto_single_v1`
- Feature Flag 표 작성(ON/OFF 기준 포함)

## Week 1
- 72h Dry Run
- 장애 분류 자동화 + 주간 장애 리포트
- 파서 실패 회귀 테스트 케이스 보강

## Week 2
- Multi-Agent를 모델 1개로 제한 오픈
- CAA/비용/지연 동시 모니터링
- 이벤트 트리거(급변동) 제한 도입

## Week 3
- Multi-Agent 전 모델 확장
- 리플레이 감사 루틴 정례화(주 1회)
- 운영 지표 기반 파라미터 튜닝

## Week 4+
- KRX/US 확장
- 국면 분석 + 통계 비교 리포트 자동화

---

## 7) 체크리스트 (실전용)

## 7-1. 실험 시작 전
- [ ] `.env` 키 유효성 확인
- [ ] 활성 Feature Flag 확인
- [ ] 실험 ID/기간/시장 범위 확정
- [ ] 비용 상한/알림 임계치 설정

## 7-2. 일일 운영
- [ ] 사이클 성공률 확인
- [ ] 상위 3개 에러 원인 확인
- [ ] 비용 급증/지연 급증 감시
- [ ] 대시보드 데이터 신선도 확인

## 7-3. 실험 종료 후
- [ ] 재현 샘플 리플레이 통과
- [ ] 결과 리포트(MD/CSV) 생성
- [ ] 실패 케이스 회고 + 런북 업데이트

---

## 8) 완료 정의 (Definition of Done)

다음 조건 충족 시 “운영 가능한 설계 완성”으로 간주.

1. P0→P1→P2 우선순위가 실제 실행 경로/플래그에 반영
2. `experiment_id` 단위 재현 가능(리플레이 검증 통과)
3. 72h 무중단 운용 로그 확보
4. 개별 모델 실패가 전체 중단으로 전파되지 않음
5. 대시보드에서 성과/상태/감사가 분리 제공
6. Cost per Signal, CAA가 기본 KPI로 노출
7. 고정 사이클 + 이벤트 트리거 동시 운용 가능
8. 리포트 자동 생성(Markdown/CSV) 가능

---

## 9) 최종 제안

이 프로젝트의 승부처는 “새 기능 개수”가 아니라 **운영 품질 + 실험 신뢰도**입니다.

즉시 실행 우선순위:
1) Phase A 통과,
2) CAA 중심의 비용 대비 성능 검증,
3) 그 다음 시장/아키텍처 확장.

이 순서를 지키면, 결과물은 단순 데모를 넘어 **취업/연구/오픈소스 모두에 통하는 실전 벤치마크 자산**이 됩니다.
